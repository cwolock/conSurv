<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Statistical methods for analyzing time-to-event data using machine learning. Implements survival stacking for conditional survival estimation and isotonic regression methods for current status data. See Wolock CJ, Gilbert PB, Simon N, and Carone M (2024) &lt;doi:10.1080/10618600.2024.2304070&gt;.">
<title>Tools for Flexible Survival Analysis Using Machine Learning • survML</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Flexible Survival Analysis Using Machine Learning">
<meta property="og:description" content="Statistical methods for analyzing time-to-event data using machine learning. Implements survival stacking for conditional survival estimation and isotonic regression methods for current status data. See Wolock CJ, Gilbert PB, Simon N, and Carone M (2024) &lt;doi:10.1080/10618600.2024.2304070&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">survML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/conditional_survival.html">Conditional survival estimation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cwolock/survML/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<!-- badges: end -->
<div class="section level1">
<div class="page-header"><h1 id="survml-tools-for-flexible-survival-analysis-using-machine-learning">
<code>survML</code>: Tools for Flexible Survival Analysis Using Machine Learning<a class="anchor" aria-label="anchor" href="#survml-tools-for-flexible-survival-analysis-using-machine-learning"></a>
</h1></div>
<p><strong>Note: The current development version of <code>survML</code> now has functionality for estimating variable importance, in addition to the original survival stacking functionality that was included in versions 1.1.0 and earlier. Documentation for the new functionality, as well as a new version on CRAN, are forthcoming.</strong></p>
<p>The <code>survML</code> package implements two methods for estimating a conditional survival function using off-the-shelf machine learning. The first, called <em>global survival stacking</em> and performed using the <code><a href="reference/stackG.html">stackG()</a></code> function, involves decomposing the conditional cumulative hazard function into regression functions depending only on the observed data. The second, called <em>local survival stacking</em> or discrete-time hazard estimation, involves discretizing time and estimating the probability of an event of interest within each discrete time period. This procedure is implemented in the <code><a href="reference/stackL.html">stackL()</a></code> function.</p>
<p>These functions can be used for both left-truncated, right-censored data (commonly seen in prospective studies) and right-truncated data (commonly seen in retrospective studies).</p>
<p>More details on each method, as well as examples, follow.</p>
<div class="section level2">
<h2 id="installing-survml">Installing <code>survML</code>
<a class="anchor" aria-label="anchor" href="#installing-survml"></a>
</h2>
<p>You can install a stable version of <code>survML</code> from CRAN using</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"survML"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the development version of <code>survML</code> is available on GitHub. You can install it using the <code>devtools</code> package as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## install.packages("devtools") # run only if necessary</span></span>
<span><span class="fu">install_github</span><span class="op">(</span>repo <span class="op">=</span> <span class="st">"cwolock/survML"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bugs-reports-and-feature-requests">Bugs reports and feature requests<a class="anchor" aria-label="anchor" href="#bugs-reports-and-feature-requests"></a>
</h2>
<p>To submit a bug report or request a new feature, please submit a new <a href="https://github.com/cwolock/survML/issues" class="external-link">GitHub Issue</a>.</p>
</div>
<div class="section level2">
<h2 id="global-survival-stacking">Global survival stacking<a class="anchor" aria-label="anchor" href="#global-survival-stacking"></a>
</h2>
<p>In a basic survival analysis setting with right-censored data (for simplicity, we don’t discuss truncation here), the ideal data for each individual consist of a covariate vector <span class="math inline"><em>X</em></span>, an event time <span class="math inline"><em>T</em></span>, and a censoring time <span class="math inline"><em>C</em></span>. The observed data consist of <span class="math inline"><em>X</em></span>, the observed follow-up time <span class="math inline"><em>Y</em> := min(<em>T</em>,<em>C</em>)</span>, and the event indicator <span class="math inline"><em>Δ</em> := <em>I</em>(<em>T</em>≤<em>C</em>)</span>. Global survival stacking requires three components: (1) the conditional probability that <span class="math inline"><em>Δ</em> = 1</span> given <span class="math inline"><em>X</em></span>, (2) the CDF of <span class="math inline"><em>Y</em></span> given <span class="math inline"><em>X</em></span> among among censored subjects, and (3) the CDF of <span class="math inline"><em>Y</em></span> given <span class="math inline"><em>X</em></span> among uncensored subjects. All three of these can be estimated using standard binary regression or classification methods.</p>
<p>Estimating (1) is a standard binary regression problem. We use pooled binary regression to estimate (2) and (3). In essence, at time <span class="math inline"><em>t</em></span> each on a user-specified grid, the CDF is a binary regression using the outcome <span class="math inline"><em>I</em>(<em>Y</em>≤<em>t</em>)</span>. The data sets for each <span class="math inline"><em>t</em></span> are combined into a single, pooled data set, including <span class="math inline"><em>t</em></span> as a covariate. Currently, <code>survML</code> allows Super Learner to be used for binary regression, but more learners will be added in future versions.</p>
<p>The <code>stackG</code> function performs global survival stacking. The most important user-specified arguments are described here:</p>
<ul>
<li>
<code>bin_size</code>: This is the size of time grid used for estimating (2) and (3). In most cases, a finer grid performs better than a coarser grid, at increased computational cost. We recommend using as fine a grid as computational resources and time allow. In simulations, a grid of 40 time points performed similarly to a grid of every observed follow-up time. Bin size is given in quantile terms; <code>bin_size = 0.025</code> will use times corresponding to quantiles <span class="math inline">{0, 0.025, 0.05, …, 0.975, 1}</span>. If <code>NULL</code>, a grid of every observed time is used.</li>
<li>
<code>time_basis</code>: This is how the time variable <span class="math inline"><em>t</em></span> is included in the pooled data set. The default is <code>continuous</code> (i.e., include time as-is). It is also possible to include a dummy variable for each time in the grid (i.e., treat time as a <code>factor</code> variable) using option <code>dummy</code>.</li>
<li>
<code>learner</code>: Currently, the only supported option is <code>SuperLearner</code>.</li>
<li>
<code>SL_control</code>: This is a named list of arguments that are passed directly to the <code>SuperLearner()</code> function. <code>SL.library</code> gives the library of algorithms to be included in the Super Learner binary regression. This argument should be vector of algorithm names, which can be either default algorithms included in the <code>SuperLearner</code> package, or user-specified algorithms. See the <code>SuperLearner</code> package documentation for more information.</li>
</ul>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Here’s a small example applying <code>stackG</code> to simulated data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This is a small simulation example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">pexp</a></span><span class="op">(</span><span class="va">t</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span>  <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">G0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">t</span> <span class="op">&lt;</span> <span class="fl">15</span><span class="op">)</span> <span class="op">*</span><span class="fl">.9</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">pexp</a></span><span class="op">(</span><span class="va">t</span>,</span>
<span>                              rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">-</span><span class="fl">.5</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="fl">.25</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="fl">.5</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">x</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                              lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">-</span><span class="fl">.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">.25</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">C</span><span class="op">[</span><span class="va">C</span> <span class="op">&gt;</span> <span class="fl">15</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">15</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="cn">T</span>, <span class="va">C</span><span class="op">)</span></span>
<span><span class="va">event</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="cn">T</span> <span class="op">&lt;=</span> <span class="va">C</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that this a very small library, just for demonstration</span></span>
<span><span class="va">SL.library</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.mean"</span>, <span class="st">"SL.glm"</span>, <span class="st">"SL.gam"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stackG.html">stackG</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span>,</span>
<span>              event <span class="op">=</span> <span class="va">event</span>,</span>
<span>              X <span class="op">=</span> <span class="va">X</span>,</span>
<span>              newX <span class="op">=</span> <span class="va">X</span>,</span>
<span>              newtimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">.1</span><span class="op">)</span>,</span>
<span>              direction <span class="op">=</span> <span class="st">"prospective"</span>,</span>
<span>              bin_size <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>              time_basis <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>              time_grid_approx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              surv_form <span class="op">=</span> <span class="st">"exp"</span>,</span>
<span>              SL_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="va">SL.library</span>,</span>
<span>                                V <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the fitted versus true conditional survival at various times for one particular individual in our data set:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">S_T_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, </span>
<span>                       true <span class="op">=</span> <span class="fu">S0</span><span class="op">(</span>t <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">.1</span><span class="op">)</span>, <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_dat</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">true</span>, y <span class="op">=</span> <span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"fitted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"true"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Global survival stacking example (event time distribution)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_stackG_example-1.png"><!-- --></p>
<p>The <code>stackG</code> function simultaneously produces estimates for the conditional censoring distribution. This may be useful, for example, for producing inverse probability of censoring (IPCW) weights.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">S_C_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, </span>
<span>                       true <span class="op">=</span> <span class="fu">G0</span><span class="op">(</span>t <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">.1</span><span class="op">)</span>, <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_dat</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">true</span>, y <span class="op">=</span> <span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"fitted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"true"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Global survival stacking example (censoring time distribution)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_stackG_example_cens-1.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="local-survival-stacking">Local survival stacking<a class="anchor" aria-label="anchor" href="#local-survival-stacking"></a>
</h2>
<p>For discrete time-to-event variables, the hazard function at a single time is a conditional probability whose estimation can be framed as a binary regression problem: among those who have not experienced the event by time <span class="math inline"><em>t</em></span>, what proportion experience the outcome at that time? Local survival stacking assumes a discrete survival process and is based on estimating this conditional event probability at each time in a user-specified grid. These binary regressions are estimated jointly by “stacking” the data sets corresponding to all times in the grid. This idea dates back at least to work by Polley and van der Laan (2011) and was also recently described by Craig et al. (2021).</p>
<div class="section level3">
<h3 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stackL.html">stackL</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">time</span>,</span>
<span>              event <span class="op">=</span> <span class="va">event</span>,</span>
<span>              X <span class="op">=</span> <span class="va">X</span>,</span>
<span>              newX <span class="op">=</span> <span class="va">X</span>,</span>
<span>              newtimes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">.1</span><span class="op">)</span>,</span>
<span>              direction <span class="op">=</span> <span class="st">"prospective"</span>,</span>
<span>              bin_size <span class="op">=</span> <span class="fl">0.02</span>,</span>
<span>              time_basis <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>              SL_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SL.library <span class="op">=</span> <span class="va">SL.library</span>,</span>
<span>                                V <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">S_T_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, </span>
<span>                       true <span class="op">=</span> <span class="fu">S0</span><span class="op">(</span>t <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span>, <span class="fl">.1</span><span class="op">)</span>, <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_dat</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">true</span>, y <span class="op">=</span> <span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"fitted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"true"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Local survival stacking example"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_stackL_example-1.png"><!-- --></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>For details of global survival stacking, please see the following paper:</p>
<p>Charles J. Wolock, Peter B. Gilbert, Noah Simon and Marco Carone. <a href="https://www.tandfonline.com/doi/full/10.1080/10618600.2024.2304070" class="external-link">“A framework for leveraging machine learning tools to estimate personalized survival curves.”</a> <em>Journal of Computational and Graphical Statistics</em> (2024).</p>
<p>Local survival stacking is described in:</p>
<p>Eric C. Polley and Mark J. van der Laan. “Super Learning for Right-Censored Data” in <em>Targeted Learning</em> (2011).</p>
<p>Erin Craig, Chenyang Zhong, and Robert Tibshirani. “Survival stacking: casting survival analysis as a classification problem.” <a href="https://arxiv.org/abs/2107.13480" class="external-link">arXiv:2107.13480.</a></p>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>After using the <code>survML</code> package, please cite the following:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="sc">@</span>article{wolock2024,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>        title<span class="ot">=</span>{A framework <span class="cf">for</span> leveraging machine learning tools to estimate personalized survival curves},</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>        author<span class="ot">=</span>{Wolock, Charles J and Gilbert, Peter B and Simon, Noah and Carone, Marco},</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>        journal<span class="ot">=</span>{Journal of Computational and Graphical Statistics},</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>        year<span class="ot">=</span>{<span class="dv">2024</span>},</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>        publisher<span class="ot">=</span>{Taylor \<span class="sc">&amp;</span> Francis},</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>        doi<span class="ot">=</span>{<span class="fl">10.1080</span><span class="sc">/</span><span class="dv">10618600</span>.<span class="fl">2024.2304070</span>}</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=survML" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/cwolock/survML/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/cwolock/survML/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing survML</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Charles Wolock <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0003-3527-1102" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=survML" class="external-link"><img src="https://www.r-pkg.org/badges/version/survML" alt="CRAN status"></a></li>
<li><a href="https://github.com/cwolock/survML/actions/workflows/R-CMD-check.yml" class="external-link"><img src="https://github.com/cwolock/survML/actions/workflows/R-CMD-check.yml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/cwolock/survML?branch=main" class="external-link"><img src="https://codecov.io/gh/cwolock/survML/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charles Wolock.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
